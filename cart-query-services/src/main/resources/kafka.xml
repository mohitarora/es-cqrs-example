<?xml version="1.0" encoding="UTF-8"?>
<beans:beans xmlns="http://www.springframework.org/schema/integration"
             xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
             xmlns:beans="http://www.springframework.org/schema/beans"
             xmlns:int-kafka="http://www.springframework.org/schema/integration/kafka"
             xsi:schemaLocation="http://www.springframework.org/schema/beans
                  http://www.springframework.org/schema/beans/spring-beans.xsd
                  http://www.springframework.org/schema/integration
                  http://www.springframework.org/schema/integration/spring-integration.xsd
                  http://www.springframework.org/schema/integration/kafka
                  http://www.springframework.org/schema/integration/kafka/spring-integration-kafka.xsd">

    <!-- Spring Integration Channel that will receive messages from Kafka -->
    <channel id="kafkaInboundChannel">
        <queue/>
    </channel>

    <!-- Spring Integration Channel Adapter provided by spring integration kafka library. This adapter will poll Kakfa
    and will deliver the messages to spring integration channel defined above-->
    <int-kafka:inbound-channel-adapter id="kafkaInboundChannelAdapter"
                                       kafka-consumer-context-ref="consumerContext"
                                       auto-startup="false"
                                       channel="kafkaInboundChannel">
        <poller fixed-delay="10" time-unit="MILLISECONDS" max-messages-per-poll="5"/>
    </int-kafka:inbound-channel-adapter>

    <!-- Kafka Consumer context -->
    <int-kafka:consumer-context id="consumerContext" consumer-timeout="4000"
                                zookeeper-connect="zookeeperConnect" consumer-properties="consumerProperties">
        <int-kafka:consumer-configurations>
            <int-kafka:consumer-configuration group-id="default" max-messages="5000">
                <int-kafka:topic-filter pattern=".*" streams="4" exclude="false"/>
            </int-kafka:consumer-configuration>
        </int-kafka:consumer-configurations>
    </int-kafka:consumer-context>

    <!-- Zoo Keeper Configuration-->
    <int-kafka:zookeeper-connect id="zookeeperConnect" zk-connect="localhost:2181" zk-connection-timeout="6000"
                                 zk-session-timeout="6000" zk-sync-time="2000"/>

    <beans:bean id="consumerProperties"
                class="org.springframework.beans.factory.config.PropertiesFactoryBean">
        <beans:property name="properties">
            <beans:props>
                <beans:prop key="auto.offset.reset">smallest</beans:prop>
                <beans:prop key="socket.receive.buffer.bytes">10485760</beans:prop>
                <!-- 10M -->
                <beans:prop key="fetch.message.max.bytes">5242880</beans:prop>
                <beans:prop key="auto.commit.interval.ms">1000</beans:prop>
            </beans:props>
        </beans:property>
    </beans:bean>

</beans:beans>
